<?xml version="1.0" encoding="utf-8"?>
<eml:eml 
    xmlns:eml="eml://ecoinformatics.org/eml-2.1.1" 
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
    xmlns:dc="http://purl.org/dc/terms/" 
    xsi:schemaLocation="eml://ecoinformatics.org/eml-2.1.1 http://rs.gbif.org/schema/eml-gbif-profile/1.0.1/eml-gbif-profile.xsd" 
    xml:lang="en" 
    packageId="iNaturalist.observations.eml.<%= Time.now.to_i %>" 
    system="http://gbif.org" 
    scope="system">
  <dataset>
    <alternateIdentifier><![CDATA[<%=raw @uri %>]]></alternateIdentifier>
    <title xml:lang="en">iNaturalist Research-grade Observations</title>
    
    <%= render :partial => 'observations/gbif_eml_agent.eml.erb', :locals => {:tag => "creator", :data => @creator} %>
    <%= render :partial => 'observations/gbif_eml_agent.eml.erb', :locals => {:tag => "metadataProvider", :data => @metadata_provider} %>
    
    <pubDate><%= Date.today.to_s %></pubDate>
    
    <!-- This is the RESOURCE language and not the metadata language which is at the bottom -->
    <language>en_US</language>
    <abstract>
      <para>Research-grade observations from iNaturalist.org. iNaturalist is a joint initiative of the California Academy of Sciences and the National Geographic Society.</para>
    </abstract>
    <intellectualRights>
      <para>
        <% if @license %>
          This work is licensed under a
          <ulink url="<%= FakeView.url_for_license( @license ) %>">
            <citetitle><%= FakeView.license_name( @license ) %></citetitle>
          </ulink>.
        <% else %>
          These data are licensed under a variety of Creative Commons licenses.
          Please see individual records for their usage requirements
        <% end %>
      </para>
    </intellectualRights>
    <!-- The distributionType URL is generally meant for informational purposes, and the "function" attribute should be set to "information". -->
    <distribution scope="document">
      <online>
        <url function="information"><%= observations_url %></url>
      </online>
    </distribution>
    <coverage>
      <% if @extent %>
      <geographicCoverage>
        <geographicDescription>Bounding Box</geographicDescription>
        <boundingCoordinates>
          <westBoundingCoordinate><%= [@extent.lower_corner.x, -180].max %></westBoundingCoordinate>
          <eastBoundingCoordinate><%= [@extent.upper_corner.x, 180].min %></eastBoundingCoordinate>
          <northBoundingCoordinate><%= [@extent.upper_corner.y, 90].min %></northBoundingCoordinate>
          <southBoundingCoordinate><%= [@extent.lower_corner.y, -90].max %></southBoundingCoordinate>
        </boundingCoordinates>
      </geographicCoverage>
      <% end %>
      <temporalCoverage>
        <rangeOfDates>
          <beginDate>
            <calendarDate><%= @start_date.to_s %></calendarDate>
          </beginDate>
          <endDate>
            <calendarDate><%= @end_date.to_s %></calendarDate>
          </endDate>
        </rangeOfDates>
      </temporalCoverage>
    </coverage>
    
    <purpose>
      <para>
        iNaturalist.org is a website where anyone can record their
        observations from nature. Members record observations for numerous
        reasons, including participation in citizen science projects, class
        projects, and personal fulfillment.
      </para>
    </purpose>
    
    <%= render :partial => 'observations/gbif_eml_agent.eml.erb', :locals => {:tag => "contact", :data => @contact} %>
    
    <methods>
      <methodStep>
        <description>
          <para>Observation recorded and verified by the community</para>
        </description>
      </methodStep>
      <qualityControl>
        <description>
          <para>
            iNaturalist observations become candidates for "research" grade
            when they have a photo, date, and coordinates. They become
            "research" grade when the community agrees on an identification.
            If the community has multiple opinions on what taxon has been
            observed, iNaturalist chooses a taxon from all the proposed taxa
            (and implied ancestor taxa of the proposed taxa) that more than
            2/3 of the voters agree with. The full algorithm is as follows:
            for all identified taxa and the taxa that contain them (e.g. genus
            Homo contains Homo sapiens), score each as the ratio between the
            number of cumulative IDs for that taxon over the sum of the
            cumulative IDs, the number of more conservative IDs added after
            the first ID of that taxon, and the number of IDs that are
            completely different (i.e. IDs of taxa that do not contain the
            taxon being scored). For the identified taxa that have a score
            over 2/3 and at least 2 identifications, iNaturalist chooses the
            lowest ranked taxon as the community taxon.
          </para>
          <para>
            An observation can lose "research" grade status if the community
            has voted it down on several metrics, including whether the
            organism is wild / naturalized (i.e. not captive / cultivated),
            whether the location and date seem accurate, and whether the
            content of the observation is appropriate for the context (e.g.
            violation of iNaturalist's Terms of Service, copyright violation,
            plagiarism, etc.).
          </para>
          <para>
            For more about data quality on iNaturalist, see
            http://www.inaturalist.org/pages/help#quality
          </para>
        </description>
      </qualityControl>
    </methods>
  </dataset>
  <additionalMetadata>
    <metadata>
      <gbif>
        <!-- eml file creation date -->
        <dateStamp><%= Time.now.iso8601 %></dateStamp>
        <!-- level to which the metadata document applies; default for GBIF is "dataset";  "series" is the other common level -->
        <hierarchyLevel> dataset </hierarchyLevel>
        <!-- URL of the logo associated with a resource -->
        <resourceLogoUrl><%= FakeView.asset_url( Site.default.logo.url, host: Site.default.url ) %></resourceLogoUrl>
      </gbif>
    </metadata>
  </additionalMetadata>
</eml:eml>
